<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <title>首页</title>
    <link type="text/css" rel="stylesheet" th:href="@{/css/pages/index_old.css}"/>
    <link th:href="@{/css/chatbox.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet" type="text/css">
    <script type="text/javascript" th:src="@{/js/pages/autoload.js}"></script><!--2D人物加载-->

    <div th:replace="~{fragments/head-base}"></div>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv=“Content-Type” content=“multipart/form-data; charset=utf-8>
</head>
<body class="body sidebar-left-hidden fixedNav_position fixedMenu_left">
<a href="javascript:;" class="comment" id="chat"></a>

<div id="chatbox">
    <div class="Container">

        <div class="top">
                    <span>To:
                        <span class="name">Britu小精灵</span>
                    </span>
            <div class="x">
                <a href="javascript:;" class="fa fa-lg fa-times" id="x"></a>
            </div>
        </div>
        <div class="content">
            <div class="bubble_you">
                <span class="img_1"></span>
                <span class="bubble_1">Hello,我是Britu小精灵。你有什么不懂的问题吗？我可是全知全能哟！</span>
            </div>
            <div class="bubble_me">
                <span class="img_2"></span>
                <span class="bubble_2">好的呢，我可是有一大堆问题想问的呢。</span>
            </div>
        </div>
        <div class="list">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
        <div class="write">
            <!--                    <a href="javascript:;" class="write-link attach"></a>-->
            <a href="javascript:;" class="recorder fa fa-lg fa-microphone" id = "Recording"></a>
            <input id="text" type="text" placeholder='尽情畅聊吧' />
            <!--                    <a href="javascript:;" class="write-link smiley"></a>-->
            <a href="javascript:;" class="send fa fa-lg fa-paper-plane" id="send"></a>

        </div>

    </div>
</div>

<div class="preloader" style=" position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 100000;
  backface-visibility: hidden;
  background: #ffffff;">
    <div class="preloader_img" style="width: 200px;
        height: 200px;
        position: absolute;
        left: 48%;
        top: 48%;
        background-position: center;
        z-index: 999999">
        <img th:src="@{/img/loader.gif}" style=" width: 50px;" alt="loading...">
    </div>
</div>
<!--wrap-->
<div id="wrap">
    <div th:replace="~{fragments/top :: top}"></div>
    <!-- /#top -->
    <div class="wrapper fixedNav_top">
        <div th:replace="~{fragments/left :: left}"></div>
        <!-- /#left -->
        <div id="content" class="bg-container">
            <header class="head">
                <div class="main-bar">
                    <div class="row no-gutters">
                        <div class="col-6">
                            <h4 class="m-t-5">
                                <i class="fa fa-home"></i><span class="ml-1">首页</span>
                            </h4>
                        </div>
                    </div>
                </div>
            </header>

            <div class="outer">
                <div class="inner bg-container">
                    <div class="row">
                        <div class="col-6">
                            <div id="welcome">
                                <div class="wel">
                                    <h1 id="one" class="text-primary">Hello!</h1>
                                    <h1 id="two">WelCome To <span>Birtu</span></h1>
                                    <br>
                                    <img style="height: 24px; margin-left: 166px;" th:src="@{/img/tu.png}">
                                    <p style="display: inline-block;" class="text-success">开始我们的学习吧！</p>
                                </div>
                            </div>
                        </div>
                        <!--轮播图-->
                        <div class="col-6">
                            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                                <ol class="carousel-indicators">
                                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                                    <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
                                </ol>
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img class="d-block w-100 h-25" th:src="@{/img/indexImg11.jpg}"
                                             alt="Second slide">
                                    </div>
                                    <div class="carousel-item">
                                        <img class="d-block w-100 h-25" th:src="@{/img/indexImg22.jpg}"
                                             alt="Third slide">
                                    </div>
                                    <div class="carousel-item">
                                        <img class="d-block w-100 h-25" th:src="@{/img/indexImg55.jpg}"
                                             alt="Third slide">
                                    </div>
                                    <div class="carousel-item">
                                        <img class="d-block w-100 h-25" th:src="@{/img/indexImg44.jpg}"
                                             alt="Third slide">
                                    </div>
                                </div>
                                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                                   data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                                   data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        </div>
                        <!--#轮播图-->

<!--                        <div id="beijin" style="float: right;">-->
<!--                            <img th:src="@{/img/image_01.png}">-->
<!--                        </div>-->
                    </div>
                    <div class="row mt-3">

                        <div class="col-6">
                            <div class="text-center ">
                                <span sec:authorize="isAuthenticated()">
<!--                                    <h3>欢迎回来，<a class="text-primary">[[${#authentication.principal.name}]]</a></h3>-->
                                </span>
<!--                                <h3 class="text-danger">[[${#dates.format(nowDate,'yyyy')}]]&nbsp;Years</h3>-->
<!--                                <h3 class="text-success">[[${#dates.format(nowDate,'MM')}]]&nbsp;Month</h3>-->
<!--                                <h3 class="text-primary">[[${#dates.format(nowDate,'dd')}]]&nbsp;Day</h3>-->
<!--                                <h4 class="text-warning">距 2020-ACM-WorldFinal 还剩 229 天</h4>-->
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-3">
                            <div class="card" style="height: 192px;">
                                <div class="card-block ">
                                    <p><i class="fa fa-paper-plane"></i><span class="ml-1">快速跳转</span></p>
                                    <input type="number" id="problemId" name="problemId"
                                           class="form-control   focused_input" placeholder="例：1001，可跳至“A+B问题”">
                                    <div class="mt-3">
                                        <button onclick="skipProblemDetail()" class="btn btn-danger float-left"
                                                type="submit">跳转
                                        </button>
                                        <button type="button" class="btn btn-primary ml-2 float-left"
                                                onclick="randomProblem()">随机跳题
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-9">


                            <div class="card">
                                <div class="card-block  ">
                                    <div class="row">
                                        <img th:src="@{/img/img1.jpg}" class="col-4">
                                        <img th:src="@{/img/img2.jpg}" class="col-4">
                                        <img th:src="@{/img/img3.jpg}" class="col-4">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-8">
                            <div class="card">
                                <div class="card-header bg-white">
                                    <i class="fa fa fa-trophy"></i>近期比赛
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-4" th:each="competition,status:${competitionList}">
                                            <div th:classappend="${status.index + 1 > 3} ? 'card-outline-warning mt-3' : 'card-outline-success'"
                                                 class="card ">
                                                <div th:classappend="${status.index + 1 > 3} ? 'bg-warning' : 'bg-success'"
                                                     class="card-header  ">
                                                    <a class="text-white"
                                                       th:href="@{'/competition/competitionDetailPage?compId='+${competition.id}}">[[${competition.competitionName}]]</a>
                                                </div>
                                                <div class="card-block">
                                                    <div>
                                                        <div class="">
                                                            <span th:if="${competition.secret}"
                                                                  class="btn btn-primary btn-sm">公开赛&nbsp;</span>
                                                            <span th:if="!${competition.secret}"
                                                                  class=" btn-primary btn-sm">私密赛&nbsp;</span>
                                                            <span class="ml-3">
                                                                <span class="text-success"
                                                                      th:if="${competition.competitionStatus == 1 }">未开始</span>
                                                                <span class="text-warning"
                                                                      th:if="${competition.competitionStatus == 2 }">进行中</span>
                                                                <span class="text-danger"
                                                                      th:if="${competition.competitionStatus == 3 }">已结束</span>
                                                            </span>
                                                            <span class=" float-right  gray-font">
                                                            [[${#dates.format(competition.startTime,'yyyy-M-d HH:mm')}]]
                                                            </span>
                                                        </div>
                                                        <div class="mt-2">
                                                            <span class=" btn-warning btn-sm">OI赛制</span>&nbsp;
                                                            <a class="text-danger ml-3"
                                                               th:href="@{'/user/mainPage?userId='+${competition.userId}}">[[${competition.name}]]</a>
                                                            <span class="gray-font  float-right">[[${#dates.format(competition.endTime,'yyyy-M-d HH:mm')}]]</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card">
                                <div class="card-header bg-white">
                                    <i class="fa fa-bullhorn"></i><span class="ml-1">本站公告</span>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-12">
                                            <div th:each="noticeBlog,status : ${noticeBlogList}">
                                                <a class="primary-hover"
                                                   th:href="@{'/blog/blogDetailPage?blogId='+${noticeBlog.id}}">
                                                    <div>[[${noticeBlog.title}]]</div>
                                                </a>
                                                <div class="mt-1">
                                                    <span class="gray-font ">发表于：[[${#dates.format(noticeBlog.createTime,'yyyy-MM-dd HH:mm:ss')}]]</span>
                                                    <span class="gray-font  float-right">浏览&nbsp;[[${noticeBlog.viewCount}]]</span>
                                                </div>
                                                <hr th:if="${status.count != status.size}" class="mt-3"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-8">
                            <div class="card">
                                <div class="card-header bg-white">
                                    <i class="fa fa-comments"></i>最新讨论
                                </div>
                                <div class="card-block ">
                                    <div class="row">
                                        <div th:classappend="${status.index + 1 > 3} ? 'mt-3':''" class="col-4"
                                             th:each="lastBlog,status:${lastBlogList}">
                                            <div class="card card-outline-primary">
                                                <div class="card-block">
                                                    <div class="row">
                                                        <div>
                                                            <a target="_blank"
                                                               th:href="@{'/user/mainPage?userId='+${lastBlog.userId}}">
                                                                <img class=" img-50  float-left rounded-circle"
                                                                     th:src="${lastBlog.avatar==null}?'img/default_avatar.jpg':${lastBlog.avatar}">
                                                            </a>
                                                        </div>
                                                        <div class="ml-3">
                                                            <div><a target="_blank"
                                                                    th:href="@{'/blog/blogDetailPage?blogId='+${lastBlog.id}}"
                                                                    class="text-primary">[[${lastBlog.title}]]</a>
                                                            </div>
                                                            <div class="font-size14">
                                                                <div class="mt-1">
                                                                    <a target="_blank"
                                                                       th:href="@{'/user/mainPage?userId='+${lastBlog.userId}}"
                                                                       class="text-danger mr-1">[[${lastBlog.name}]]</a>
                                                                    <span class="gray-font">In</span>
                                                                    <a th:href="@{'/blog/blogListPage?bcId='+${lastBlog.bcId}}"
                                                                       class="ml-1 primary-hover" target="_blank"
                                                                       th:text="${'['+lastBlog.bcName+']'}"></a>
                                                                </div>

                                                                <div class="mt-1 gray-font">
                                                                    @[[${#dates.format(lastBlog.replyTime,'yyyy-MM-dd
                                                                    HH:mm:ss')}]]回复
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">

                            <div class="card">
                                <div class="card-header bg-white">
                                    <i class="fa fa-user"></i><span class="ml-1">友情链接</span>
                                </div>
                                <div class="card-block ">
                                    <p>
                                        <a target="_blank" href="https://www.luogu.org/" class="text-primary">洛谷 - 计算机科学教育新生态</a>
                                    </p>
                                    <p>
                                        <a target="_blank" href="https://www.jisuanke.com/" class="text-primary">计蒜客 - 学习面向未来的计算机科学</a>
                                    </p>
                                    <p>
                                        <a target="_blank" href="https://leetcode.com" class="text-primary">LeetCode - 全球极客挚爱的技术成长平台</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- /.inner -->
    </div>
    <!-- /.outer -->
    <!-- /#content -->
    <!-- Modal -->
    <div class="modal fade" id="search_modal" tabindex="-1" role="dialog" aria-hidden="true">
        <form th:action="@{/problem/problemListPage}" method="post">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="float-right" aria-hidden="true">&times;</span>
                    </button>
                    <div class="input-group search_bar_small">
                        <input type="text" class="form-control" placeholder="题目搜索" name="keyword">
                        <span class="input-group-btn">
                          <button class="btn btn-secondary" type="submit"><i class="fa fa-search"></i></button>
                        </span>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- /#content -->
    <!-- # right side -->
</div>
<!-- /#wrap -->
<!-- global scripts-->
<div th:replace="~{fragments/footer :: footer}"></div>
<!--end of global scripts-->
<!--  plugin scripts -->
<script type="text/javascript" th:src="@{/js/pages/index.js}"></script>
<!--end of plugin scripts-->
<script type="text/javascript" th:inline="javascript"></script>
<script src="/js/index.js"></script>

<!--对话交流js-->
<script>
    var send =document.getElementById('send');
    // var pic =document.getElementById('pic');
    var text =document.getElementById('text');
    // var info_box = document.getElementsByClassName('info_box')[0];
    var chat = document.getElementById('chat');
    chat.onclick=function(){
        document.getElementById("chatbox").style.bottom = "10px";

    };
   //上传录音
    var recording = document.getElementById('Recording');
    var num = 0;
    var recorder;
    recording.onclick = function(){
        if((num % 2) === 0){
            startRecording();
            alert("开始语音识别，再点击录音按钮结束");
            num++;
        }
        else{
            alert("识别结束，等待结果");
            stopRecording();
            uploadAudio();
            num++;
        }
    }
    function startRecording(){
        swrecorder.get(function(rec) {
            recorder = rec
            recorder.start()
        })
    }

    function stopRecording(){
        recorder.stop();
    }
    function playRecording() {
        recorder.play(document.querySelector("audio"));

    }
    function uploadAudio(){
        recorder.upload("http://127.0.0.1:9944/aliSubmit", function(state,e) {
            console.log(e,state)
        })
    }



    var x = document.getElementById('x');

    x.onclick=function(){
        document.getElementById("chatbox").style.bottom = "-1000px";
    };
    send.onclick=function(){
        if(text.value===''){
            alert('请输入内容');
        } else{
            var div = document.createElement('div');
            var span_1 = document.createElement('span');
            var span_2 = document.createElement('span');

            var txt = document.createTextNode(text.value);
            var content = document.getElementsByClassName('content')[0];
            //声明请求变量
            var xhr = new XMLHttpRequest();
            var fd = new FormData();

            span_1.appendChild(txt);
            div.appendChild(span_2);
            div.appendChild(span_1);
            // div.appendChild(imgs);
            // nDiv.style.display='block';
            content.insertBefore(div,content.lastChild);
            span_1.className='bubble_2';
            span_2.className='img_2';
            div.className='bubble_me';
            // imgs.src='img/2.jpg';
            //请求后台
            var url = 'http://yuangauss287.top:9944/api/qa?msg='+ text.value;
            xhr.open("GET", url);
            xhr.send(fd);

            //处理请求的返回值
            xhr.onreadystatechange = function() {//Call a function when the state changes.
                if(xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {//xhr.readyState == 4等价于XMLHttpRequest.DONE
                    // 请求结束后,在此处写处理代码

                    var jsoncontent = JSON.parse(xhr.responseText);/*将获取的信息解析为json对象*/

                    if(jsoncontent['code'] == 200){


                        var message = jsoncontent['message'];
                        var data = jsoncontent['data'];
                        if(message == 'Success'){
                            // 创建节点
                            var txt2 = document.createTextNode(data);

                            var div = document.createElement('div');
                            var span_1 = document.createElement('span');
                            var span_2 = document.createElement('span');
                            // var img = document.createElement('img');
                            // var txt = document.createTextNode(text.value);
                            var content = document.getElementsByClassName('content')[0];

                            span_1.appendChild(txt2);
                            div.appendChild(span_2);
                            div.appendChild(span_1);
                            // div.appendChild(imgs);
                            // nDiv.style.display='block';
                            content.insertBefore(div,content.lastChild);
                            span_1.className='bubble_1';
                            span_2.className='img_1';
                            div.className='bubble_you';

                        }
                        else{
                            // 创建节点
                            var txt2 = document.createTextNode(message);

                            var div = document.createElement('div');
                            var span_1 = document.createElement('span');
                            var span_2 = document.createElement('span');
                            // var img = document.createElement('img');
                            // var txt = document.createTextNode(text.value);
                            var content = document.getElementsByClassName('content')[0];

                            span_1.appendChild(txt2);
                            div.appendChild(span_2);
                            div.appendChild(span_1);
                            // div.appendChild(imgs);
                            // nDiv.style.display='block';
                            content.insertBefore(div,content.lastChild);
                            span_1.className='bubble_1';
                            span_2.className='img_1';
                            div.className='bubble_you';
                        }

                    }




                }
            }
        }
        text.value='';
    }


</script>
</body>

</html>
